(this["webpackJsonpwieldy-hook"]=this["webpackJsonpwieldy-hook"]||[]).push([[28],{778:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a(0);var n=a(2);function r(e){return Object(n.jsx)("div",{style:{display:"flex",flexDirection:e.column?"column":"row",alignItems:e.alignItems||"center",justifyContent:e.between?"space-between":"start"},className:e.className,children:e.children})}},860:function(e,t,a){"use strict";a.r(t);var n=a(4),r=a(28),i=a(15),s=a(14),c=a(19),o=a(20),l=a(10),u=a.n(l),d=a(0),m=a.n(d),h=a(187),p=a(95),f=a(97),j=a(434),b=a(810),x=a(286),v=a(813),g=a(805),O=a(763),w=a(832),y=a(858),k=a(760),S=a(758),C=a(791),R=a(792),A=a(27),I=a(778),H={maxWidth:2e3,maxHeight:2e3,quality:.8};function q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=document.createElement("canvas"),n=document.createElement("img"),r=Object.assign(H,t),i=r.maxWidth,s=r.maxHeight,c=r.quality;return new Promise((function(t,r){n.onload=function(){var e=n.width,r=n.height;e>r?e>i&&(r=Math.round(r*=i/e),e=i):r>s&&(e=Math.round(e*=s/r),r=s),a.width=e,a.height=r,a.getContext("2d").drawImage(n,0,0,e,r),t(a.toDataURL("image/jpeg",c))},n.onerror=function(e){t(!1)},n.src=e}))}function N(e){return new Promise((function(t,a){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){var e=n.result,a=e.toString(),r=/^data:(.*,)?/,i=a.match(r)[0],s=a.replace(r,"");s.length%4>0&&(s+="=".repeat(4-s.length%4)),t({encoded:s,type:i,readerResult:e})},n.onerror=function(e){return a(e)}}))}var z=a(2),D=function(e){Object(c.a)(a,e);var t=Object(o.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"userprofile.",a=n.props.intl;return a.formatMessage({id:t+e})},n.save=function(){var e=Object(r.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.props.user,n.setState({pending:!0}),e.next=4,n.context.api.q("/user/set",{username:a.raw.profile.username,password:t.password,email:t.email,name:t.name});case 4:e.sent?(j.b.success(n.m("save.success","")),n.onAfterSave()):(j.b.error(n.m("save.fail","")),n.setState({pending:!1}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.prepareAvatar=Object(r.a)(u.a.mark((function e(){var t,a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.state.fileInputRef.current){e.next=19;break}if(!n.state.fileInputRef.current.files[0]){e.next=16;break}if(n.setState({pending:!0}),t=n.state.fileInputRef.current.files[0],!((a=window.appConfig.maxFileSize)&&t.size>a)){e.next=9;break}return j.b.error("".concat(n.m("file.size.exceed",""),": ").concat(Math.round(a/1024)," ").concat(n.m("kb",""))),n.setState({pending:!1}),e.abrupt("return");case 9:return e.next=11,N(t);case 11:r=e.sent,q(r.readerResult,{maxWidth:200,maxHeight:200}).then((function(e){e?n.saveAvatar(e):(j.b.error(n.m("file.read.failed","")),n.setState({pending:!1}))})),e.next=17;break;case 16:n.modalHide();case 17:e.next=20;break;case 19:n.modalHide();case 20:case"end":return e.stop()}}),e)}))),n.saveAvatar=function(){var e=Object(r.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({pending:!0}),e.next=3,n.context.api.q("/user/profile/set",{picture:t});case 3:e.sent?(j.b.success(n.m("save.success","")),n.onAfterSave()):(j.b.error(n.m("save.fail","")),n.setState({pending:!1}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.modalShow=function(){n.setState({modalShow:!0})},n.modalHide=function(){n.setState({modalShow:!1})},n.onAfterSave=function(){document.location.reload()},n.state={pending:!1,moodalShow:!1,fileInputRef:m.a.createRef()},n}return Object(s.a)(a,[{key:"render",value:function(){var e=this,t=this.props.user,a=this.state,r=a.pending,i=a.modalShow,s=a.fileInputRef;return Object(z.jsxs)("div",{children:[Object(z.jsx)(f.a,{children:Object(z.jsx)("title",{children:this.m("profile")})}),Object(z.jsx)(b.a,{title:this.m("avatar.change"),visible:i,onOk:this.prepareAvatar,onCancel:this.modalHide,footer:[Object(z.jsx)(x.a,{onClick:this.modalHide,children:this.m("cancell","")},"cancell"),Object(z.jsx)(x.a,{onClick:function(){return e.saveAvatar("")},children:this.m("avatar.remove")},"remove"),Object(z.jsx)(x.a,{type:"primary",loading:r,onClick:this.prepareAvatar,children:this.m("save","")},"submit")],children:Object(z.jsx)(v.a,{spinning:r,children:Object(z.jsx)("input",{ref:s,type:"file",className:"form-control"})})}),Object(z.jsx)("h2",{className:"title gx-mb-4",children:this.m("profile")}),Object(z.jsx)(g.a,{children:Object(z.jsxs)(I.a,{children:[Object(z.jsx)("div",{className:"gx-pointer",onClick:this.modalShow,children:t.show.picture?Object(z.jsx)(O.a,{size:64,src:t.show.picture,style:{marginRight:"15px"}}):Object(z.jsx)(O.a,{size:64,style:{marginRight:"15px"},children:t.show.literal})}),Object(z.jsxs)("div",{children:[Object(z.jsx)("h5",{children:t.show.hello}),Object(z.jsxs)(w.b,{children:[Object(z.jsx)(y.a,{style:{backgroundColor:"#52c41a"},count:this.m("active")}),t.isAdmin&&Object(z.jsx)(y.a,{style:{backgroundColor:"#038FDE"},count:this.m("admin")}),t.isGuest&&Object(z.jsx)(y.a,{style:{backgroundColor:"#a0d911"},count:this.m("guest")})]})]})]})}),Object(z.jsx)(g.a,{children:Object(z.jsx)(v.a,{spinning:r,children:Object(z.jsxs)(k.a,Object(n.a)(Object(n.a)({name:"basic",onFinish:this.save,className:"gx-signin-form gx-form-row0",autoComplete:"off"},{labelCol:{span:8},wrapperCol:{span:16}}),{},{children:[Object(z.jsx)(k.a.Item,{rules:[{required:!0,type:"email",message:this.m("email.invalid")}],name:"email",label:this.m("email"),initialValue:t.raw.profile.email,children:Object(z.jsx)(S.a,{placeholder:this.m("email")})}),Object(z.jsx)(k.a.Item,{rules:[{required:!0,message:this.m("name.invalid")}],name:"name",label:this.m("name"),initialValue:t.raw.profile.name,children:Object(z.jsx)(S.a,{placeholder:this.m("name")})}),Object(z.jsxs)(C.a,{children:[Object(z.jsx)(R.a,{span:8}),Object(z.jsx)(R.a,{span:16,children:Object(z.jsx)(x.a,{type:"primary",htmlType:"submit",loading:r,children:this.m("save","")})})]})]}))})})]})}}]),a}(m.a.Component);D.contextType=p.a;t.default=Object(A.c)((function(e){return{user:e.user}}),null)(Object(h.c)(D))}}]);