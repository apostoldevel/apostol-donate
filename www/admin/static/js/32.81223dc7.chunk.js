(this["webpackJsonpwieldy-hook"]=this["webpackJsonpwieldy-hook"]||[]).push([[32],{866:function(e,t,a){"use strict";a.r(t);var n=a(3),s=a(28),r=a(15),i=a(14),c=a(19),o=a(20),l=a(10),d=a.n(l),h=a(0),u=a.n(h),m=a(187),p=a(95),j=a(98),b=a(435),x=a(807),f=a(287),g=a(814),O=a(813),v=a(764),w=a(835),k=a(864),y=a(761),S=a(759),C=a(795),R=a(796),A=a(27),I=a(192),q={maxWidth:2e3,maxHeight:2e3,quality:.8};function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=document.createElement("canvas"),n=document.createElement("img"),s=Object.assign(q,t),r=s.maxWidth,i=s.maxHeight,c=s.quality;return new Promise((function(t,s){n.onload=function(){var e=n.width,s=n.height;e>s?e>r&&(s=Math.round(s*=r/e),e=r):s>i&&(e=Math.round(e*=i/s),s=i),a.width=e,a.height=s,a.getContext("2d").drawImage(n,0,0,e,s),t(a.toDataURL("image/jpeg",c))},n.onerror=function(e){t(!1)},n.src=e}))}function H(e){return new Promise((function(t,a){var n=new FileReader;n.readAsDataURL(e),n.onload=function(){var e=n.result,a=e.toString(),s=/^data:(.*,)?/,r=a.match(s)[0],i=a.replace(s,"");i.length%4>0&&(i+="=".repeat(4-i.length%4)),t({encoded:i,type:r,readerResult:e})},n.onerror=function(e){return a(e)}}))}var P=a(810),z=a(2),F=function(e){Object(c.a)(a,e);var t=Object(o.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"userprofile.",a=n.props.intl;return a.formatMessage({id:t+e})},n.save=function(){var e=Object(s.a)(d.a.mark((function e(t){var a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.props.user,n.setState({pending:!0}),e.next=4,n.context.api.q("/user/set",{username:a.raw.profile.username,password:t.password,email:t.email,name:t.name});case 4:e.sent?(b.b.success(n.m("save.success","")),n.onAfterSave()):(b.b.error(n.m("save.fail","")),n.setState({pending:!1}));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.changePassword=function(){var e=Object(s.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({pending:!0}),e.next=3,n.context.api.q("/user/password",{oldpass:t.oldpass,newpass:t.newpass});case 3:e.sent?(b.b.success(n.m("save.success","")),n.onAfterSave()):(b.b.error(n.m("save.fail","")),n.setState({pending:!1}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.prepareAvatar=Object(s.a)(d.a.mark((function e(){var t,a,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.state.fileInputRef.current){e.next=19;break}if(!n.state.fileInputRef.current.files[0]){e.next=16;break}if(n.setState({pending:!0}),t=n.state.fileInputRef.current.files[0],!((a=window.appConfig.maxFileSize)&&t.size>a)){e.next=9;break}return b.b.error("".concat(n.m("file.size.exceed",""),": ").concat(Math.round(a/1024)," ").concat(n.m("kb",""))),n.setState({pending:!1}),e.abrupt("return");case 9:return e.next=11,H(t);case 11:s=e.sent,N(s.readerResult,{maxWidth:200,maxHeight:200}).then((function(e){e?n.saveAvatar(e):(b.b.error(n.m("file.read.failed","")),n.setState({pending:!1}))})),e.next=17;break;case 16:n.modalHide();case 17:e.next=20;break;case 19:n.modalHide();case 20:case"end":return e.stop()}}),e)}))),n.saveAvatar=function(){var e=Object(s.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({pending:!0}),e.next=3,n.context.api.q("/user/profile/set",{picture:t});case 3:e.sent?(b.b.success(n.m("save.success","")),n.onAfterSave()):(b.b.error(n.m("save.fail","")),n.setState({pending:!1}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.modalShow=function(){n.setState({modalShow:!0})},n.modalHide=function(){n.setState({modalShow:!1})},n.onAfterSave=function(){document.location.reload()},n.state={pending:!1,moodalShow:!1,fileInputRef:u.a.createRef()},n}return Object(i.a)(a,[{key:"render",value:function(){var e=this,t=this.props.user,a=this.state,s=a.pending,r=a.modalShow,i=a.fileInputRef,c={labelCol:{span:8},wrapperCol:{span:16}},o="".concat(window.appConfig.wsDomain,"/ocpp/").concat(t.raw.account);return Object(z.jsxs)("div",{children:[Object(z.jsx)(j.a,{children:Object(z.jsx)("title",{children:this.m("profile")})}),Object(z.jsx)(x.a,{title:this.m("avatar.change"),visible:r,onOk:this.prepareAvatar,onCancel:this.modalHide,footer:[Object(z.jsx)(f.a,{onClick:this.modalHide,children:this.m("cancell","")},"cancell"),Object(z.jsx)(f.a,{onClick:function(){return e.saveAvatar("")},children:this.m("avatar.remove")},"remove"),Object(z.jsx)(f.a,{type:"primary",loading:s,onClick:this.prepareAvatar,children:this.m("save","")},"submit")],children:Object(z.jsx)(g.a,{spinning:s,children:Object(z.jsx)("input",{ref:i,type:"file",className:"form-control"})})}),Object(z.jsx)("h2",{className:"title gx-mb-4",children:this.m("profile")}),Object(z.jsx)(O.a,{children:Object(z.jsxs)(I.a,{between:!0,children:[Object(z.jsxs)(I.a,{children:[Object(z.jsx)("div",{className:"gx-pointer",onClick:this.modalShow,children:t.show.picture?Object(z.jsx)(v.a,{size:64,src:t.show.picture,style:{marginRight:"15px"}}):Object(z.jsx)(v.a,{size:64,style:{marginRight:"15px"},children:t.show.literal})}),Object(z.jsxs)("div",{children:[Object(z.jsx)("h5",{children:t.show.hello}),Object(z.jsxs)(w.b,{children:[Object(z.jsx)(k.a,{style:{backgroundColor:"#52c41a"},count:this.m("active")}),t.isAdmin&&Object(z.jsx)(k.a,{style:{backgroundColor:"#038FDE"},count:this.m("admin")}),t.isGuest&&Object(z.jsx)(k.a,{style:{backgroundColor:"#a0d911"},count:this.m("guest")})]})]})]}),Object(z.jsxs)("div",{className:"gx-text-right",children:[Object(z.jsxs)("div",{children:[this.m("connection"),":"]}),Object(z.jsxs)("div",{className:"gx-text-muted gx-font-weight-light gx-mt-1",children:[o,Object(z.jsx)("span",{className:"gx-ml-2 gx-link",onClick:function(){navigator.clipboard.writeText(o),b.b.success(e.m("copied"))},children:Object(z.jsx)(P.a,{})})]})]})]})}),Object(z.jsx)(O.a,{children:Object(z.jsx)(g.a,{spinning:s,children:Object(z.jsxs)(y.a,Object(n.a)(Object(n.a)({name:"basic",onFinish:this.save,className:"gx-signin-form gx-form-row0",autoComplete:"off"},c),{},{children:[Object(z.jsx)(y.a.Item,{rules:[{required:!0,type:"email",message:this.m("email.invalid")}],name:"email",label:this.m("email"),initialValue:t.raw.profile.email,children:Object(z.jsx)(S.a,{placeholder:this.m("email")})}),Object(z.jsx)(y.a.Item,{rules:[{required:!0,message:this.m("name.invalid")}],name:"name",label:this.m("name"),initialValue:t.raw.profile.name,children:Object(z.jsx)(S.a,{placeholder:this.m("name")})}),Object(z.jsxs)(C.a,{children:[Object(z.jsx)(R.a,{span:8}),Object(z.jsx)(R.a,{span:16,children:Object(z.jsx)(f.a,{type:"primary",htmlType:"submit",loading:s,children:this.m("save","")})})]})]}))})}),Object(z.jsxs)("h2",{className:"gx-mb-4",children:[this.m("passchange")," "]}),Object(z.jsx)(O.a,{children:Object(z.jsx)(g.a,{spinning:s,children:Object(z.jsxs)(y.a,Object(n.a)(Object(n.a)({name:"basic",onFinish:this.changePassword,className:"gx-signin-form gx-form-row0",autoComplete:"off"},c),{},{children:[Object(z.jsx)(y.a.Item,{rules:[{required:!0}],label:this.m("oldpass"),name:"oldpass",children:Object(z.jsx)(S.a.Password,{})}),Object(z.jsx)(y.a.Item,{rules:[{required:!0}],label:this.m("newpass"),name:"newpass",children:Object(z.jsx)(S.a.Password,{})}),Object(z.jsxs)(C.a,{children:[Object(z.jsx)(R.a,{span:8}),Object(z.jsx)(R.a,{span:16,children:Object(z.jsx)(f.a,{type:"primary",htmlType:"submit",loading:s,children:this.m("change","")})})]})]}))})})]})}}]),a}(u.a.Component);F.contextType=p.a;t.default=Object(A.c)((function(e){return{user:e.user}}),null)(Object(m.c)(F))}}]);